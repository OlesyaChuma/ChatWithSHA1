#include "Chat.h"

// ----------------------
// Конструктор класса Chat
// ----------------------
Chat::Chat() {}

// ----------------------
// Регистрация пользователя
// ----------------------
// login — логин пользователя (ключ)
// pass  — пароль в открытом виде
// len   — длина пароля
//
// При регистрации пароль:
// 1) хешируется с помощью SHA-1
// 2) в хеш-таблицу сохраняется пара: логин → хеш пароля
//
void Chat::reg(char login[LOGINLENGTH], char pass[], int len) {
    // Вычисляем SHA-1 хеш от пароля
    uint* hash = sha1(pass, len);

    // Добавляем логин и хеш пароля в хеш-таблицу
    users.add(login, hash);
}

// ----------------------
// Попытка входа пользователя
// ----------------------
// Возвращает true, если логин и пароль верны,
// false — если логина нет или пароль неверный
//
bool Chat::login(char login[LOGINLENGTH], char pass[], int len) {

    // Ищем сохранённый хеш пароля по логину
    uint* stored = users.find(login);

    // Если логин не найден — вход невозможен
    if (!stored)
        return false;

    // Вычисляем SHA-1 хеш от введённого пароля
    uint* current = sha1(pass, len);

    // Сравниваем сохранённый хеш и текущий
    bool ok = !memcmp(stored, current, SHA1HASHLENGTHBYTES);

    // Освобождаем память временного хеша
    delete[] current;

    // Возвращаем результат проверки
    return ok;
}
